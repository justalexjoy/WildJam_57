[gd_scene load_steps=18 format=3 uid="uid://bg0kdmun24hhy"]

[ext_resource type="Texture2D" uid="uid://ca218nosisfw6" path="res://assets/Player/idle/adventurer-idle-00.png" id="2_lqres"]
[ext_resource type="Texture2D" uid="uid://n5rcpkjge7q0" path="res://assets/Player/idle/adventurer-idle-01.png" id="3_cojwt"]
[ext_resource type="Texture2D" uid="uid://dcue5tfxt2yon" path="res://assets/Player/idle/adventurer-idle-02.png" id="4_xt1va"]
[ext_resource type="Texture2D" uid="uid://doxid22kn7fn1" path="res://assets/Player/idle/adventurer-idle-03.png" id="5_23cgy"]
[ext_resource type="Texture2D" uid="uid://d14jj7ebxjqrh" path="res://assets/Player/run/adventurer-run-00.png" id="6_0sfuh"]
[ext_resource type="Texture2D" uid="uid://cl6ekixeygoee" path="res://assets/Player/jump/adventurer-jump-00.png" id="6_165ja"]
[ext_resource type="Texture2D" uid="uid://m4dq3or7mvst" path="res://assets/Player/jump/adventurer-jump-01.png" id="7_tmjao"]
[ext_resource type="Texture2D" uid="uid://c1kguhf77x2lc" path="res://assets/Player/run/adventurer-run-01.png" id="7_wehpc"]
[ext_resource type="Texture2D" uid="uid://bf77attrc6m3r" path="res://assets/Player/jump/adventurer-jump-02.png" id="8_1q4m5"]
[ext_resource type="Texture2D" uid="uid://dimoh5ife2jdq" path="res://assets/Player/run/adventurer-run-02.png" id="8_8c3by"]
[ext_resource type="Texture2D" uid="uid://crafg0napbhux" path="res://assets/Player/jump/adventurer-jump-03.png" id="9_8rj5s"]
[ext_resource type="Texture2D" uid="uid://csreyrkxvfh42" path="res://assets/Player/run/adventurer-run-03.png" id="9_e26f0"]
[ext_resource type="Texture2D" uid="uid://dhmiadi3f3dwf" path="res://assets/Player/run/adventurer-run-04.png" id="10_5wjjt"]
[ext_resource type="Texture2D" uid="uid://x8b16muqltt" path="res://assets/Player/run/adventurer-run-05.png" id="11_r2jmk"]

[sub_resource type="GDScript" id="GDScript_n5830"]
script/source = "extends Actor


const SPEED = 350.0
const JUMP_VELOCITY = -400.0
const MAX_DASH_NUMBER = 2

# Get the gravity from the project settings to be synced with RigidBody nodes.
# var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")

@onready var sprite = $AnimatedSprite2D

var _state = CharacterState.STAY
var _dashCount = 0
var _direction = 0

enum CharacterState {
  WALK,
  STAY,
  JUMP,
}

func _physics_process(delta):
	get_state()
	get_input()

	var force = 0
	if is_on_floor():
		force = SPEED
	else:
		force = SPEED * 0.6

	if _direction:		
		velocity.x = _direction * force
	else:		 
		velocity.x = move_toward(velocity.x, 0, force)

	if not is_on_floor():
		velocity.y += gravity * delta

	animate_state()
	move_and_slide()
	check_falling()
	
func get_input():
	# Handle Jump.
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	if Input.is_action_just_pressed(\"ui_accept\") and not is_on_floor() and _dashCount > 0:
		velocity.y = JUMP_VELOCITY * 0.8 * _dashCount/MAX_DASH_NUMBER
		_dashCount -= 1

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	_direction = Input.get_axis(\"ui_left\", \"ui_right\")

func get_state():
	if is_on_floor() and _direction:
		_state = CharacterState.WALK

	if is_on_floor():
		_dashCount = MAX_DASH_NUMBER

	if not is_on_floor() and _direction:
		_state = CharacterState.JUMP

	if not _direction:
		_state = CharacterState.STAY

func animate_state():
	match _state:
		CharacterState.JUMP:
			sprite.play(\"jump\")
		CharacterState.WALK:
			sprite.play(\"run\")
		CharacterState.STAY:
			sprite.play(\"idle\")

	sprite.flip_h = _direction < 0

func check_falling():
	if global_position.y > 1000:
		get_tree().change_scene_to_file(\"res://UI/game_over_layer.tscn\")

"

[sub_resource type="SpriteFrames" id="SpriteFrames_r57uc"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("2_lqres")
}, {
"duration": 1.0,
"texture": ExtResource("3_cojwt")
}, {
"duration": 1.0,
"texture": ExtResource("4_xt1va")
}, {
"duration": 1.0,
"texture": ExtResource("5_23cgy")
}],
"loop": true,
"name": &"idle",
"speed": 6.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("6_165ja")
}, {
"duration": 1.0,
"texture": ExtResource("7_tmjao")
}, {
"duration": 1.0,
"texture": ExtResource("8_1q4m5")
}, {
"duration": 1.0,
"texture": ExtResource("9_8rj5s")
}],
"loop": true,
"name": &"jump",
"speed": 7.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("6_0sfuh")
}, {
"duration": 1.0,
"texture": ExtResource("7_wehpc")
}, {
"duration": 1.0,
"texture": ExtResource("8_8c3by")
}, {
"duration": 1.0,
"texture": ExtResource("9_e26f0")
}, {
"duration": 1.0,
"texture": ExtResource("10_5wjjt")
}, {
"duration": 1.0,
"texture": ExtResource("11_r2jmk")
}],
"loop": true,
"name": &"run",
"speed": 8.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_6kj61"]
size = Vector2(12, 30)

[node name="Player" type="CharacterBody2D"]
script = SubResource("GDScript_n5830")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(1, 0)
sprite_frames = SubResource("SpriteFrames_r57uc")
animation = &"run"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(3, 3)
shape = SubResource("RectangleShape2D_6kj61")

[node name="Camera2D" type="Camera2D" parent="."]
